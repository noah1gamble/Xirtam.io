define("discourse/plugins/retort/discourse/lib/retort",["exports","discourse/lib/ajax","discourse/lib/ajax-error"],function(t,e,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=_.compact(_.invoke(Discourse.SiteSettings.retort_disabled_categories.split("|"),"toLowerCase"));t.default=Ember.Object.create({callback:function(t){this.postFor(t.id).setProperties({retorts:t.retorts}),this.get("widgets."+t.id).scheduleRerender()},postFor:function(t){return this.get("topicController.model.postStream.posts").find(function(e){return e.id==t})},storeWidget:function(t){this.get("widgets")||this.set("widgets",{}),this.set("widgets."+t.getModel().id,t.widget)},updateRetort:function(t,r){return(0,e.ajax)("/retorts/"+t+".json",{type:"POST",data:{retort:r}}).catch(i.popupAjaxError)},disabledFor:function(t){var e=this.postFor(t),i=e?e.get("topic.category.name")||"":"";return r.includes(i.toLowerCase())||e.get("topic.archived")},openPicker:function(t){this.set("picker.active",!0),this.set("picker.postId",t.id)},setPicker:function(t){var e=this;this.set("picker",t),this.set("picker.onSelect",function(i){e.updateRetort(t.postId,i).then(function(){e.set("picker.active",!1)})}),this.set("picker.limitOptions",Discourse.SiteSettings.retort_limited_emoji_set)}})}),define("discourse/plugins/retort/discourse/connectors/above-site-header/emoji-picker-wrapper",["exports","../../lib/retort"],function(t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={setupComponent:function(t,i){e.default.setPicker(i)}}}),define("discourse/plugins/retort/discourse/initializers/retort-init",["exports","discourse/lib/plugin-api","discourse/routes/topic","../lib/retort"],function(t,e,i,r){"use strict";function o(t){var e=t.container.lookup("site-settings:main");i.default.on("setupTopicController",function(t){var e=t.controller;r.default.set("topicController",e),e.messageBus.subscribe("/retort/topics/"+e.model.id,function(t){r.default.callback(t)})}),t.decorateWidget("post-contents:after-cooked",function(t){var e=t.getModel().id,i=r.default.postFor(e);if(!r.default.disabledFor(e))return r.default.storeWidget(t),_.map(i.retorts,function(e){return t.attach("retort-toggle",{post:i,usernames:e.usernames,emoji:e.emoji})})}),Discourse.User.current()&&e.retort_enabled&&(t.addPostMenuButton("retort",function(t){if(!r.default.disabledFor(t.id))return{action:"clickRetort",icon:"smile-o",title:"retort.title",position:"first"}}),t.attachWidgetAction("post-menu","clickRetort",function(){r.default.openPicker(this.findAncestorModel())}))}Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"retort-button",initialize:function(){(0,e.withPluginApi)("0.8.6",function(t){return o(t)})}}}),define("discourse/plugins/retort/discourse/widgets/templates/retort-toggle",["exports","virtual-dom","discourse/lib/text"],function(t,e,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=Ember.Object.create({render:function(t){return this.state=t.state,[this.emoji(),this.count(),this.tooltip()]},emoji:function(){return(0,e.h)("img.emoji",{src:(0,i.emojiUrlFor)(this.state.emoji),alt:":"+this.state.emoji+":"})},count:function(){if(!(this.state.usernames.length<2))return(0,e.h)("span.post-retort__count",this.state.usernames.length.toString())},tooltip:function(){return(0,e.h)("span.post-retort__tooltip",this.sentence())},sentence:function(){return I18n.t(this.sentenceKey(),{first:this.state.usernames[0],second:this.state.usernames[1],count:this.state.usernames.length-2,emoji:this.state.emoji})},sentenceKey:function(){switch(this.state.usernames.length){case 1:return"retort.reactions.one_person";case 2:return"retort.reactions.two_people";default:return"retort.reactions.many_people"}}})}),define("discourse/plugins/retort/discourse/widgets/retort-toggle",["exports","discourse/widgets/widget","../widgets/templates/retort-toggle","../lib/retort"],function(t,e,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=(0,e.createWidget)("retort-toggle",{tagName:"button.post-retort",buildKey:function(t){return"retort-toggle-"+t.emoji+"-"+t.usernames.length},defaultState:function(t){return{emoji:t.emoji,post:t.post,usernames:t.usernames}},click:function(){r.default.updateRetort(this.state.post.id,this.state.emoji)},html:function(){return i.default.render(this)}})}),define("discourse/plugins/retort/discourse/components/retort-picker",["exports","discourse/components/emoji-picker","discourse/lib/text"],function(t,e,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Discourse.SiteSettings;t.default=e.default.extend({_scrollTo:function(t){r.retort_limited_emoji_set||this._super(t)},_unbindRetort:function(){this.set("active",!1),this.close()},_bindEvents:function(){var t=this;return this.$(document).on("keydown.retort-escape",function(e){27==e.target&&t._unbindRetort()}),this.$(document).on("click.retort-click-outside",function(e){$(e.target).closest(".retort-picker").length||t._unbindRetort()}),this._super()},_unbindEvents:function(){return this.$(document).off("click.retort-click-outside"),this.$(document).off("click.retort-escape"),this._super()},_loadCategoriesEmojis:function(){var t=this;if(r.retort_limited_emoji_set){var e=this.$(".emoji-picker"),o=this._flexBasis();e.html(""),this._allowedEmojis().map(function(r){e.append('<button type="button" title="'+r+'" class="emoji" />'),t.$('button.emoji[title="'+r+'"]').css("background-image",'url("'+(0,i.emojiUrlFor)(r)+'")').css("flex-basis",o+"%")}),this._bindEmojiClick(e)}else this._super()},_allowedEmojis:function(){return r.retort_allowed_emojis.split("|")},_flexBasis:function(){return 100/this._emojisPerRow[this._allowedEmojis().length]||5},_emojisPerRow:{0:1,1:1,2:2,3:3,4:4,5:5,6:3,7:3,8:4,9:3,10:5,11:5,12:4,13:5,14:7,15:5,16:4,17:5,18:6,19:6,20:5,21:7,22:5,23:5,24:6}})}),Ember.TEMPLATES["javascripts/connectors/above-site-header/emoji-picker-wrapper"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[7,"div"],[12,"class",[30,["retort__emoji-picker-wrapper\\n  ",[29,"if",[[25,["limitOptions"]],"retort__emoji-picker-wrapper--limited"],null],"\\n  ",[29,"if",[[25,["active"]],"retort__emoji-picker-wrapper--active"],null]]]],[9],[0,"\\n  "],[1,[29,"retort-picker",null,[["active","emojiSelected","automaticPositioning"],[[25,["active"]],[25,["onSelect"]],false]]],false],[0,"\\n"],[10],[0,"\\n"]],"hasEval":false}',meta:{moduleName:"javascripts/connectors/above-site-header/emoji-picker-wrapper"}}),Ember.TEMPLATES["javascripts/components/retort-picker"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[7,"div"],[11,"class","retort-picker emoji-picker"],[9],[10],[0,"\\n"]],"hasEval":false}',meta:{moduleName:"javascripts/components/retort-picker"}});
//# sourceMappingURL=/assets/plugins/retort-be9501f39ae362d15bf37d22627c90dca95b46d0605cc0700dd71741f47afbf6.js.map