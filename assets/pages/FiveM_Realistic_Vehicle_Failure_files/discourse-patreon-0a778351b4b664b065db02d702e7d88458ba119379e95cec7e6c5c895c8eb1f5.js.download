define("discourse/plugins/discourse-patreon/discourse/controllers/admin-plugins-patreon",["exports","ember-addons/ember-computed-decorators","discourse/plugins/discourse-patreon/discourse/models/filter-rule","discourse/lib/ajax","discourse/lib/ajax-error"],function(e,t,n,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s,l;e.default=Ember.Controller.extend((s=(0,t.default)("rewards"),l={prettyPrintReward:function(e){return"$"+e.amount_cents/100+" - "+e.title},rewardsNames:function(){var e=this;return _.filter(this.rewards,function(e){return e.id>=0}).map(function(t){return e.prettyPrintReward(t)})},editing:n.default.create({}),actions:{save:function(){var e=this,t=this.get("editing"),s=this.get("model");t.set("group",this.groups.find(function(e){return e.id===parseInt(t.get("group_id"))})),t.set("rewards_ids",_.filter(this.rewards,function(n){return t.get("reward_list").includes(e.prettyPrintReward(n))}).map(function(e){return e.id})),(0,a.ajax)("/patreon/list.json",{method:"POST",data:t.getProperties("group_id","rewards_ids")}).then(function(){var a=s.find(function(e){return e.get("group_id")===t.get("group_id")}),r=t.get("reward_list").replace(/\|/g,", ");a?(a.set("reward_list",r),a.set("rewards",r),a.set("rewards_ids",t.rewards_ids)):s.pushObject(n.default.create({group:t.get("group.name"),rewards:r})),e.set("editing",n.default.create({}))}).catch(r.popupAjaxError)},delete:function(e){var t=this.get("model");(0,a.ajax)("/patreon/list.json",{method:"DELETE",data:e.getProperties("group_id")}).then(function(){var n=t.find(function(t){return t.get("group_id")===e.get("group_id")});t.removeObject(n)}).catch(r.popupAjaxError)},updateData:function(){var e=this;this.set("updatingData",!0),(0,a.ajax)("/patreon/update_data.json",{method:"POST"}).catch(r.popupAjaxError).finally(function(){return e.set("updatingData",!1)}),this.messageBus.subscribe("/patreon/background_sync",function(){e.messageBus.unsubscribe("/patreon/background_sync"),e.set("updatingData",!1),bootbox.alert(I18n.t("patreon.refresh_page"),function(){window.location.pathname=Discourse.getURL("/admin/plugins/patreon")})})}}},function(e,t,n,a,r){var s={};return Object.keys(a).forEach(function(e){s[e]=a[e]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=n.slice().reverse().reduce(function(n,a){return a(e,t,n)||n},s),r&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(r):void 0,s.initializer=void 0),void 0===s.initializer&&(Object.defineProperty(e,t,s),s=null),s}(l,"rewardsNames",[s],Object.getOwnPropertyDescriptor(l,"rewardsNames"),l),l))}),define("discourse/plugins/discourse-patreon/discourse/patreon-route-map",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={resource:"admin.adminPlugins",path:"/plugins",map:function(){this.route("patreon")}}}),define("discourse/plugins/discourse-patreon/discourse/models/filter-rule",["exports","discourse/models/rest"],function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=t.default.extend({group_id:-1,reward_list:""})}),Ember.TEMPLATES["javascripts/connectors/admin-user-details/patreon"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[4,"if",[[24,0,["siteSettings","patreon_enabled"]]],null,{"statements":[[0,"  "],[7,"section"],[11,"class","details"],[9],[0,"\\n    "],[7,"h1"],[9],[1,[29,"i18n",["patreon.title"],null],false],[10],[0,"\\n    "],[7,"div"],[11,"class","display-row"],[9],[0,"\\n      "],[7,"div"],[11,"class","field"],[9],[1,[29,"i18n",["patreon.field.id"],null],false],[10],[0,"\\n      "],[7,"div"],[11,"class","value"],[9],[1,[25,["model","patreon_id"]],false],[10],[0,"\\n    "],[10],[0,"\\n"],[4,"if",[[25,["model","patreon_email"]]],null,{"statements":[[0,"    "],[7,"div"],[11,"class","display-row"],[9],[0,"\\n      "],[7,"div"],[11,"class","field"],[9],[1,[29,"i18n",["patreon.field.email"],null],false],[10],[0,"\\n      "],[7,"div"],[11,"class","value"],[9],[1,[25,["model","patreon_email"]],false],[10],[0,"\\n    "],[10],[0,"\\n"]],"parameters":[]},null],[4,"if",[[25,["model","patreon_amount_cents"]]],null,{"statements":[[0,"    "],[7,"div"],[11,"class","display-row"],[9],[0,"\\n      "],[7,"div"],[11,"class","field"],[9],[1,[29,"i18n",["patreon.field.amount_cents"],null],false],[10],[0,"\\n      "],[7,"div"],[11,"class","value"],[9],[1,[25,["model","patreon_amount_cents"]],false],[10],[0,"\\n    "],[10],[0,"\\n"]],"parameters":[]},null],[4,"if",[[25,["model","patreon_rewards"]]],null,{"statements":[[0,"    "],[7,"div"],[11,"class","display-row"],[9],[0,"\\n      "],[7,"div"],[11,"class","field"],[9],[1,[29,"i18n",["patreon.field.rewards"],null],false],[10],[0,"\\n      "],[7,"div"],[11,"class","value"],[9],[1,[25,["model","patreon_rewards"]],false],[10],[0,"\\n    "],[10],[0,"\\n"]],"parameters":[]},null],[4,"if",[[25,["model","patreon_declined_since"]]],null,{"statements":[[0,"    "],[7,"div"],[11,"class","display-row"],[9],[0,"\\n      "],[7,"div"],[11,"class","field"],[9],[1,[29,"i18n",["patreon.field.declined_since"],null],false],[10],[0,"\\n      "],[7,"div"],[11,"class","value"],[9],[1,[29,"format-date",[[25,["model","patreon_declined_since"]]],null],true],[10],[0,"\\n    "],[10],[0,"\\n"]],"parameters":[]},null],[0,"    "],[7,"div"],[11,"class","display-row"],[9],[0,"\\n      "],[7,"div"],[11,"class","field"],[9],[1,[29,"i18n",["patreon.field.more_details.label"],null],false],[10],[0,"\\n      "],[7,"div"],[11,"class","value"],[9],[7,"a"],[11,"target","_blank"],[12,"href",[30,[[23,"patron_url"]]]],[9],[1,[29,"d-icon",["external-link-alt"],null],false],[10],[10],[0,"\\n      "],[7,"div"],[11,"class","controls"],[9],[0,"\\n"],[4,"if",[[25,["model","patreon_email"]]],null,{"statements":[[0,"          "],[1,[29,"i18n",["patreon.field.more_details.help_text.email_available"],null],false],[0,"\\n"]],"parameters":[]},{"statements":[[0,"          "],[1,[29,"i18n",["patreon.field.more_details.help_text.email_not_available"],null],false],[0,"\\n"]],"parameters":[]}],[0,"      "],[10],[0,"\\n    "],[10],[0,"\\n  "],[10],[0,"\\n"]],"parameters":[]},null]],"hasEval":false}',meta:{moduleName:"javascripts/connectors/admin-user-details/patreon"}}),define("discourse/plugins/discourse-patreon/discourse/templates/connectors/admin-user-details/patreon",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={setupComponent:function(e,t){var n=e.model.patreon_email,a="https://patreon.com/members";n&&(a=a+"?query="+n),t.set("patron_url",a)},shouldRender:function(e,t){return t.siteSettings.patreon_enabled&&e.model.patreon_id}}}),Ember.TEMPLATES["javascripts/admin/plugins-patreon"]=Ember.HTMLBars.template({id:null,block:'{"symbols":["rule"],"statements":[[7,"section"],[11,"id","patreon"],[9],[0,"\\n  "],[7,"h1"],[9],[1,[29,"i18n",["patreon.header.rules"],null],false],[10],[0,"\\n  "],[7,"table"],[9],[0,"\\n    "],[7,"tr"],[9],[0,"\\n      "],[7,"th"],[9],[1,[29,"i18n",["patreon.group"],null],false],[10],[0,"\\n      "],[7,"th"],[9],[1,[29,"i18n",["patreon.rewards"],null],false],[10],[0,"\\n      "],[7,"th"],[9],[10],[0,"\\n    "],[10],[0,"\\n\\n"],[4,"each",[[25,["model"]]],null,{"statements":[[0,"      "],[7,"tr"],[11,"class",""],[9],[0,"\\n        "],[7,"td"],[9],[1,[24,1,["group"]],false],[10],[0,"\\n        "],[7,"td"],[9],[1,[24,1,["rewards"]],false],[10],[0,"\\n        "],[7,"td"],[9],[0,"\\n          "],[7,"div"],[11,"class","pull-right"],[9],[0,"\\n            "],[1,[29,"d-button",null,[["action","actionParam","icon","class","title"],["delete",[24,1,[]],"far-trash-alt","delete btn-danger","patreon.delete"]]],false],[0,"\\n          "],[10],[0,"\\n        "],[10],[0,"\\n      "],[10],[0,"\\n"]],"parameters":[1]},null],[0,"\\n    "],[7,"tr"],[11,"class","new-filter"],[9],[0,"\\n      "],[7,"td"],[9],[1,[29,"combo-box",null,[["value","content"],[[25,["editing","group_id"]],[25,["groups"]]]]],false],[10],[0,"\\n      "],[7,"td"],[9],[1,[29,"list-setting",null,[["settingValue","choices","class"],[[25,["editing","reward_list"]],[25,["rewardsNames"]],"rewards"]]],false],[10],[0,"\\n      "],[7,"td"],[9],[0,"\\n        "],[7,"div"],[11,"class","pull-right"],[9],[0,"\\n          "],[1,[29,"d-button",null,[["action","icon","class","title"],["save","check","save btn-primary","patreon.save"]]],false],[0,"\\n        "],[10],[0,"\\n      "],[10],[0,"\\n    "],[10],[0,"\\n  "],[10],[0,"\\n\\n  "],[7,"p"],[9],[1,[29,"i18n",["patreon.help_text"],null],false],[10],[0,"\\n\\n  "],[1,[29,"d-button",null,[["action","icon","class","disabled","title","label"],["updateData","refresh","test",[25,["updatingData"]],"patreon.update_data","patreon.update_data"]]],false],[0,"\\n\\n"],[4,"if",[[25,["last_sync_at"]]],null,{"statements":[[0,"    "],[7,"span"],[11,"class","last_synced"],[9],[1,[29,"i18n",["patreon.last_synced"],null],false],[0,": "],[1,[29,"format-date",[[25,["last_sync_at"]]],[["leaveAgo"],["true"]]],true],[10],[0,"\\n"]],"parameters":[]},null],[10],[0,"\\n"]],"hasEval":false}',meta:{moduleName:"javascripts/admin/plugins-patreon"}}),define("discourse/plugins/discourse-patreon/discourse/routes/admin-plugins-patreon",["exports","discourse/models/group","discourse/lib/ajax","discourse/plugins/discourse-patreon/discourse/models/filter-rule"],function(e,t,n,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function e(e,t){var n=[],a=!0,r=!1,s=void 0;try{for(var l,i=e[Symbol.iterator]();!(a=(l=i.next()).done)&&(n.push(l.value),!t||n.length!==t);a=!0);}catch(e){r=!0,s=e}finally{try{!a&&i.return&&i.return()}finally{if(r)throw s}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();e.default=Discourse.Route.extend({model:function(){return Ember.RSVP.Promise.all([(0,n.ajax)("/patreon/list.json"),t.default.findAll({ignore_automatic:!0})]).then(function(e){var t=r(e,2),n=t[0],a=t[1];return{filters:n.filters,rewards:n.rewards,last_sync_at:n.last_sync_at,groups:a}})},setupController:function(e,t){var n=t.rewards,r=t.groups,s=_.map(t.filters,function(e,t){var s=e.map(function(e){return n[e]?" $"+n[e].amount_cents/100+" - "+n[e].title:""}),l=_.find(r,function(e){return e.id===parseInt(t)});return a.default.create({group:l.name,rewards:s,group_id:t,reward_ids:e})});e.setProperties({model:s,groups:r,rewards:n,last_sync_at:t.last_sync_at})}})});
//# sourceMappingURL=/assets/plugins/discourse-patreon-0a778351b4b664b065db02d702e7d88458ba119379e95cec7e6c5c895c8eb1f5.js.map